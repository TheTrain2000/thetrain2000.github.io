<!-- <iframe src="https://trinket.io/embed/python3/86bf47d208?runOption=run" width="100%" height="700" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe> -->

<html>
<head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

          // Load the Visualization API and the corechart package.
          google.charts.load('current', {'packages':['corechart','line']});

          // Set a callback to run when the Google Visualization API is loaded.
          google.charts.setOnLoadCallback(initialize);

        function randint(min, max) {
          min = Math.ceil(min);
          max = Math.floor(max);
          return Math.floor(Math.random() * (max - min + 1)) + min; //The maximum is inclusive and the minimum is inclusive
        }

        function getData() {
            var generations = Number(document.getElementById('generations').value);
            var mouse_count = Number(document.getElementById('starting_mice').value);
            var coyote_count = Number(document.getElementById('starting_coyote').value);
            var needed_to_live = Number(document.getElementById('mice_to_live').value);
            var max_pups = Number(document.getElementById('max_coyote_pups').value);
            var mice_to_reproduce = Number(document.getElementById('mice_to_reproduce').value);
            var mice_multiplier = Number(document.getElementById('mice_multiplier').value);

            var generation_array = [];

            generation_array.push([0, mouse_count, coyote_count]);

            for (i = 1; i <= generations; i++) {
                for (j = 0; j < coyote_count; j++) {
                    var landed_on = randint(0, Math.floor(mouse_count/10));
                    if (mouse_count - landed_on <= 1) {
                        continue;
                    }
                    mouse_count -= landed_on;
                    var mice_after_living = landed_on - needed_to_live;
                    if (landed_on < needed_to_live) {
                        if (coyote_count > 1) {
                            coyote_count -= 1;
                        continue;
                        }
                    }
                    else if (mice_after_living >= mice_to_reproduce) {
                        var pups = Math.floor(mice_after_living / mice_to_reproduce);
                        if (pups > max_pups) {
                            pups = max_pups;
                        }
                        coyote_count += pups;
                    }
                }

                mouse_count *= mice_multiplier;
                generation_array.push([i, mouse_count, coyote_count]);
                console.log(i, mouse_count, coyote_count)
            }
            return generation_array
        }

        function drawChart() {

          var data = new google.visualization.DataTable();
          data.addColumn('number', 'Generation');
          data.addColumn('number', 'Mice');
          data.addColumn('number', 'Coyotes');

          var simData = getData();
          data.addRows(simData);

          var generations = document.getElementById('generations').value.toString();
          var options = {
            chart: {
              title: 'Coyote/Mouse Simulation',
              subtitle: generations.concat(' generations')
            },
            width: 900,
            height: 450,
            hAxis: {
                title: 'Generation'
            },
            vAxis: {
                title: 'Count'
            },
            curveType: 'function'
          };

          var chart = new google.charts.Line(document.getElementById('chart_div'));

          chart.draw(data, google.charts.Line.convertOptions(options));
        }

        function initialize() {
            var button = document.getElementById('generate')
            button.onclick = function () {
                drawChart()
            }
        }
    </script>
</head>
<br>

<pre>
Generations             : <input type="number" id="generations" value="50" title="How many generations to simulate."/><br />

Starting Mice           : <input type="number" id="starting_mice" value="100" title="The amount of mice the simulation starts with."/><br />
Starting Coyote         : <input type="number" id="starting_coyote" value="10" title="The amount of coyotes the simulation starts with."/><br />
Mice Needed to Live     : <input type="number" id="mice_to_live" value="2" title="The amount of mice a coyote needs to eat in order to live."/><br />
Max Coyote Offspring    : <input type="number" id="max_coyote_pups" value="5" title="The maximum offspring a single coyote can have."/><br />
Mice Breeding Multiplier: <input type="number" id="mice_multiplier" value="2" title="The multiplier by which mice breed at the end of a generation."/><br />
Mice Needed to Reproduce: <input type="number" id="mice_to_reproduce" value="2" title="The amount of mice to produce one coyote pup, after a coyote eats the mice needed to live."/><br />
<button id="generate">Generate</button></pre>


<div id="chart_div"></div>

<br>Written by Tyler Gibbs for AP Environmental Science.<br>
<a href="https://github.com/TheTrain2000/thetrain2000.github.io/blob/master/sim/index.html">source code</a>
</body>
</html>